<!-- Header -->

<style>

header ul a,header a.active,header a:active,header a:focus, header a:hover {
        color: #7B533F;
}

li {
  list-style-type: none;
}

.post-list {
    margin: 0;
    padding: 0;
    list-style-type: none;
}

.post-list li {
    padding: 8px 0;
    border-bottom: 1px solid #ccc;
    border-bottom: 1px solid rgba(0,0,0,0.1);
    font-size: 18px;
    font-size: 2.1rem;
    line-height: 1.33333;
    margin-bottom: 0;
}

.post-list li:after {
    content: "";
    display: table;
    clear: both;
}

.post-list a {
    text-decoration: none;
    color: #222;
}

.entry-tags {
    display: block;
    margin-top: .5em;
    text-transform: uppercase;
    font-size: 1.15rem;
    line-height: 2.18182;
    margin-bottom: 24px;
    margin-bottom: 1.5rem;
    font-weight: 600;
}

.entry-tags a {
    padding: .2em .4em;
    margin: 0 .2em;
    background-color: #fff;
    color: #202d3b;
    border-radius: 5px;
    border: 2px solid #202d3b;
}

.post-list a>span {
    float: right;
}

@media screen and (min-width: 48em)
.post-list .entry-date {
    display: inline;
}

.post-list .entry-date {
    font-size: 18px;
    font-size: 1.3rem;
    line-height: 1.71429;
    margin-bottom: 0;
    text-transform: uppercase;
}

@media screen and (min-width: 62.5em)
.post-list .abstract {
    width: 60%;
}

.post-list .abstract {
    display: block;
    float: none;
    font-size: 14px;
    font-size: 1.6rem;
    line-height: 1.14286;
    margin-bottom: 0;
}

.tag-box {
    list-style: none;
    margin: 0;
    padding: 4px 0;
    overflow: hidden;
}

.tag-box.inline li {
    float: left;
    font-size: 14px;
    font-size: 1.875rem;
    line-height: 1.71429;
    margin-bottom: 24px;
    margin-bottom: 1.4rem;
    line-height: 2.5;
}

.tag-box a {
    padding: 4px 6px;
    margin: 2px;
    color: #fff;
    background-color: #7B533F;
    border-radius: 4px;
    text-decoration: none;
}

.tag-box a span {
    vertical-align: super;
    font-size: 10px;
    font-size: 1.3rem;
    line-height: 2.4;
    margin-bottom: 24px;
    margin-bottom: 1.5rem;
}

</style>


{% assign count_workshops = 0 %}
{% for product in site.categories.resources %}
  {% if product.id == "workshops" %}
    {% assign count_workshops = count_workshops | plus: 1 %}
  {% endif %}
{% endfor %}

{% assign count_events = 0 %}
{% for product in site.categories.resources %}
  {% if product.id == "events" %}
    {% assign count_events = count_events | plus: 1 %}
  {% endif %}
{% endfor %}

{% assign count_bibliography = 0 %}
{% for product in site.categories.resources %}
  {% if product.id == "bibliography" %}
    {% assign count_bibliography = count_bibliography | plus: 1 %}
  {% endif %}
{% endfor %}

<header>
    <div class="container" style="padding-top:120px;padding-bottom:10px;">
        <div class="row">
            <div class="col-lg-12">

                <div class="col-lg-12 text-center">
                    <h2>Resources</h2>
                    <hr class="star-primary2">
                </div>

                <div>
                    <h4 class="page-title" style="text-transform: none;">The Resources page is broken down by resources found in workshops, products, bibliography, and ethics</h4>
                </div>

                <ul class="nav nav-tabs" style="padding: 10px 10px 0px 10px;">
                  <li class="active"><a href="#workshops" data-toggle="tab">workshop materials</a></li>
                  <li><a href="#products" data-toggle="tab">products</a></li>
                  <li><a href="#tools" data-toggle="tab">tools</a></li>
                  <li><a href="#bibliography" data-toggle="tab">bibliography</a></li>
                  <li><a href="#ethics" data-toggle="tab">ethics</a></li>
                </ul>
            </div>
        </div>
    </div>
</header>

<div class="container" style="padding-top:10px;padding-bottom:80px;">
    <div class="row">
        <div class="col-lg-12">

            <div class="tab-content" style="padding: 10px;">

                <div id="workshops" class="tab-pane active">

<!--used to build site cloud-->
{% capture site_tags %}
{% for post in site.categories.resources %}{% for tag in post.tags %}'{{ tag }}'{% unless forloop.last %},{% endunless %}{% endfor %}{% unless forloop.last %},{% endunless %}{% endfor %}
{% endcapture %}

                    <div class="tag-cloud">
                        <ul class="tag-box inline">
                        </ul>
                    </div>

                    <ul class="post-list" data-search-results>

                    {% for post in site.categories.resources %}

                       <li>
                        <article>
                            {% if post.external_url %}
                                <a href="{{ post.external_url }}">{{ post.title }} <span class="entry-date"><time datetime="{{ post.date | date_to_xmlschema }}">{{ post.date | date: "%B %d, %Y" }}</time></span>{% if post.abstract %} <span class="abstract">{{ post.abstract }}</span>{% endif %}</a>
                            {% else %}
                                <a href="{{ site.baseurl }}{{ post.url }}">{{ post.title }} <span class="entry-date"><time datetime="{{ post.date | date_to_xmlschema }}">{{ post.date | date: "%B %d, %Y" }}</time></span>{% if post.abstract %} <span class="abstract">{{ post.abstract }}</span>{% endif %}</a>
                            {% endif %}

                            <span class="entry-tags">
                                {% if post.tags %}
                                    {% for tag in post.tags %}
                                        <a href="{{ site.baseurl }}/resources/#tab_workshops#{{ tag | url_encode }}" title="Posts tagged {{ tag }}" id="{{ tag | url_encode }}">{{ tag }}</a>
                                        {% unless forloop.last %}
                                        {% endunless %}
                                    {% endfor %}
                                {% endif %}
                            </span>
                        </article>
                      </li>

                    {% endfor %}

                    </ul>
                </div>

                <div id="products" class="tab-pane ">
                {% for product in site.categories.resources %}
                  {% if product.id == "events" %}
                    {% capture thecycle %}{% cycle 'odd', 'even' %}{%endcapture%}
                    {% if thecycle == 'odd' %}
                      {% include main/listitem_product.html odd=true %}
                    {% else %}
                      {% include main/listitem_product.html odd=false %}
                    {% endif %}
                  {% endif %}
                {% endfor %}
                </div>

                <div id="tools" class="tab-pane ">
                {% for product in site.categories.resources %}
                  {% if product.id == "events" %}
                    {% capture thecycle %}{% cycle 'odd', 'even' %}{%endcapture%}
                    {% if thecycle == 'odd' %}
                      {% include main/listitem_product.html odd=true %}
                    {% else %}
                      {% include main/listitem_product.html odd=false %}
                    {% endif %}
                  {% endif %}
                {% endfor %}

                <iframe src="https://docs.google.com/spreadsheets/d/1Ui2G_ZPCbgxmRJ8r93WOS47zwPItfOI74vUM9W7AnDI/pubhtml?gid=531126027&single=true&widget=true&headers=false" align="center" height = "600px" width = "98%"></iframe>

                </div>

                  <div id="bibliography" class="tab-pane ">
<strong>The Secondary Cities team manages their bibliography using the open source Zotero platfrom. The blocking of 3rd-party cookies may prevent viewing this page correctly, however, you can visit the <a href="https://www.zotero.org/groups/secondary_cities/items">Secondary Cities Zotero page</a> directly.</strong>
</p>

<!--
                        <div style="text-align:center;">
                            <a href="https://www.zotero.org/groups/secondary_cities/items">
                                <button type="button" class="btn btn-default2" style="font-size:16px;padding:6px;margin-top:6px"><i class="fa"></i>Visit the 2C Bibliography Page on <img src="https://www.zotero.org/static/images/theme/zotero.png" width="220px"></button>
                            </a>
                        </div>
-->

                        <iframe src="https://www.zotero.org/groups/secondary_cities/items" name="ZoteroLibary" scrolling="auto" frameborder="no" align="center" height = "600px" width = "98%">
</iframe>
                  </div>

                  <div id="ethics" class="tab-pane ">
                    As GIS professionals, the Secondary Cities team and partners support and strictly adhere to the GIS code of ethics from <a href="https://www.gisci.org/Portals/0/Ethics/CodeOfEthics_PR.pdf">GISCI</a> and <a href="http://www.urisa.org/clientuploads/directory/Documents/CodeofEthics.pdf">URISA</a>.
This Code of Ethics is intended to provide guidelines for GIS (geographic information system) professionals. It should help professionals make appropriate and ethical choices. It should provide a basis for evaluating their work from an ethical point of view. By heeding this code, GIS professionals will help to preserve and enhance public trust in the discipline.
                  </div>

            
            </div>
        </div>
    </div>
</div>


<script>

//document ready makes sure bootstrap is loaded first
$( document ).ready(function() {
    console.log('doc loc hash');
    console.log(document.location.hash);
    // Javascript to enable link to tab
    var hash = document.location.hash;
    var prefix = "tab_";

    hash_no_tab = hash.replace(prefix,"");

    if (hash) {
      $(".nav-tabs a[href='"+hash_no_tab+"']").tab('show');
    } 

    // Changes hash in the address bar for page-reload
    $('.nav-tabs a').on('shown.bs.tab', function (e) {
      window.location.hash = e.target.hash.replace("#", "#" + prefix);
    });
});

    //building tag cloud
    var counts = {};

    array = [{{ site_tags }}];

    for (var i = 0; i < array.length; i++) {
        counts[array[i]] = (counts[array[i]] + 1) || 1;
    }

    console.log('does it work?');
    console.log(counts);
    console.log(counts.length);

    for (var key in counts) { 
        //text += cars[i] + "<br>";
        console.log(key);
        console.log(counts[key]);
        console.log('testing url encode: ');
        console.log(encodeURIComponent(key));
        tag_hash = encodeURIComponent(key);
        tag_hash = tag_hash.replace(/%20/g, "+");
        console.log(tag_hash);
        $('.tag-box').append("<li><a href='{{ site.baseurl }}/resources/#tab_workshops#"+tag_hash+"' id='"+tag_hash+"'>"+key+"<span>"+counts[key]+"</span></a></li>");
    }
</script>

<script>

    //defining vars globally
    var vars;

    $(window).on('hashchange',function(){ 

        vars = location.hash.slice(1).split('#');

        //removing tab_workshops from array
        var index = vars.indexOf('tab_workshops');
        vars.splice(index, 1);

        console.log('printing vars1: ');
        console.log(vars);
        
        $(".entry-tags a").removeAttr('style');
        $(".tag-cloud a").removeAttr('style');

        $('.tab-content .post-list li').hide();

        if (location.hash.slice(1) == 'tab_workshops') {
            $('.tab-content li').show();
            //in case double-clicking on a button reset list and changed the url hash to tab_workshops
            //you need to re-build all the correct hashes for the buttons
            $("a[href$='tab_workshops']").attr('href', function() {
                return this.pathname +'#tab_workshops#'+ this.id;
            });
        }

        //loop through each li parent in post-list
            //for each parent look to see if any of the vars variables
            //match any of a parent's entry tags
            //if so you can show the li parent

        show_parent_array = $('<ul class="post-list" data-search-results>');

        //loop through each li parent in post-list
        $( ".post-list li" ).each(function() {
            entry_tags_array = $( this ).find( ".entry-tags a" );

            var myTags = [];
            entry_tags_array.each(function(){
              myTags.push($(this).attr('id'));
            });

            var show_parent = true;

            //for each of vars variables in the vars array
            for (var i = 0; i < vars.length; i++) {
                //console.log('vars val');
                //console.log(vars[i]);
                if (myTags.indexOf(vars[i]) === -1) {
                  // element doesn't exist in array
                  //console.log('breaking array');
                  var show_parent = false;
                  break; 
                  //or else continue
                }
            }

            if (show_parent == true) {
                //now you can show li
                //styling for the tags
                for (var i = 0; i < vars.length; i++) {
                    //console.log('vars val2');
                    //console.log(vars[i]);
                    $( this ).find( ".entry-tags a[id='"+vars[i]+"']" ).css( "background-color", "#202d3b" );
                    $( this ).find( ".entry-tags a[id='"+vars[i]+"']" ).css( "color", "#18bc9c" );

                    //styling for tags in tag cloud
                    $( ".tag-box a[id='"+vars[i]+"']" ).css( "background-color", "#202d3b" );
                    $( ".tag-box a[id='"+vars[i]+"']" ).css( "color", "#18bc9c" );
                }

                $( this ).show();

                //show_parent_array.push($( this ));

                // Merge object2 into object1

                $( this ).clone().appendTo(show_parent_array);
                //show_parent_array.clone( $( this ) );
            }

        });

        console.log('show parent array: ');
        console.log(show_parent_array);

        //have a list of parents that are being shown
        show_parent_entry_tags_array = show_parent_array.find(".entry-tags a");

        var show_parent_array_tags = [];
        show_parent_entry_tags_array.each(function(){
          show_parent_array_tags.push($(this).attr('id'));
        });

        console.log('show_parent_array_tags ');
        console.log(show_parent_array_tags);

        //looping through all tags in tag cloud
        for (var key in counts) { 

            console.log(key);
            console.log(counts[key]);

            tag_hash = encodeURIComponent(key);
            tag_hash = tag_hash.replace(/%20/g, "+");
            console.log(tag_hash);

            //if tag does not show up in any of the shown parent's tags
            if (show_parent_array_tags.indexOf(tag_hash) === -1) {
                console.log('make tag unclickable');
                console.log(key);

                //then make the tag in the tag cloud unclickable
                $( ".tag-box a[id='"+tag_hash+"']" ).css( "pointer-events", "none" );
            }
        }

    });
</script>

<!-- http://stackoverflow.com/questions/7862233/twitter-bootstrap-tabs-go-to-specific-tab-on-page-reload-or-hyperlink -->
<script>

    //when a tag is clicked for an entry
    $( '.entry-tags a,.tag-box a' ).on( "click", function() {
        console.log( 'click check: ' +$( this ).text() );
        console.log( $( this ).attr("href") );
        console.log(window.location.pathname+window.location.hash);

        //console.log('can I still use the vars list?');
        //console.log(vars);

        console.log('id in vars list?');
        console.log( $( this ).attr("id") );

        tag_id = $( this ).attr("id")

        if (vars) {

            if (vars.indexOf(tag_id) > -1) {
                console.log('tag selected twice');
                //removing tab_workshops from array
                var index = vars.indexOf('tag_id');
                vars.splice(index, 1);

                console.log('print window location hash');
                console.log( window.location.hash );
                window.location.hash = window.location.hash.replace("#"+tag_id, "");

                console.log('print window location hash2');
                console.log( window.location.hash );

                //base_url = window.location.href;
                //add to url depending on tag clicked
                //new_url = base_url + window.location.href;
                console.log('new url2: ');
                console.log(new_url);

                $( this ).attr("href", window.location.hash)

            } else {
                console.log('else was selected ');
                base_url = window.location.href;
                //add to url depending on tag clicked
                new_url = base_url + '#' + $( this ).attr("id");
                console.log('new url: ');
                console.log(new_url);

                $( this ).attr("href", new_url)
            }

        }

        //console.log('new vars');
        //console.log(vars);

    });
        
</script>
